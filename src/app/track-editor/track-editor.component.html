<mat-card class="mat-elevation-z0">
	<mat-card-title>One-Press Song Creator</mat-card-title>
	<mat-card-subtitle>A tool for quickly and easily creating One-Press parts for the BeatBuddy from midi files
	</mat-card-subtitle>
</mat-card>

<mat-horizontal-stepper [linear]="false" #stepper>
	<mat-step>
		<ng-template matStepLabel>Upload file</ng-template>
		<div>
			<button mat-button matStepperNext [disabled]="!file.value">Next</button>
		</div>
		<form>
			<input #file type="file" (change)="uploadFile($event);stepper.next()">
    </form>

	</mat-step>
	<mat-step>
		<ng-template matStepLabel>Edit tracks</ng-template>
		<div>
			<button mat-button matStepperPrevious>Previous</button>
			<button mat-button matStepperNext>Next</button>
		</div>
		<div class="example-action-buttons">
			<div>
				<mat-checkbox [(ngModel)]="moveNotes">Move unsupported notes to nearest octave</mat-checkbox>
			</div>
			<div>
				<mat-checkbox [(ngModel)]="moveDrums">Move unsupported drums to closest equivalent (tom 4 to tom 3 etc)
				</mat-checkbox>
			</div>
			<!-- div>
				<mat-checkbox [(ngModel)]="remove0VelocityNotes">Remove 0 velocity notes</mat-checkbox>
			</div -->
			<div>Transpose <input [(ngModel)]="transpose" max="12" min="-12" type="number" value="0"></div>
				<select #kitSelector [(ngModel)]="kitSelection" (change)="presetInstrumentSelection();export.updateMidiFileName()">
    <optgroup *ngFor="let kitGroup of presets | keyvalue" [label]="kitGroup.key">
      <option *ngFor="let kit of kitGroup.value | keyvalue" [ngValue]="kit.key">{{kit.key}} ({{kit.value.join(', ')}})</option>
    </optgroup>
    
  </select>
				<button mat-button (click)="resetPresetInstruments()"><mat-icon>refresh</mat-icon>Reset</button>
				<button mat-button (click)="clearPresetInstruments()"><mat-icon>clear</mat-icon>Clear</button>

			</div>
      <table mat-table
       [dataSource]="midi?.tracks" multiTemplateDataRows
       class="mat-elevation-z8">
  <ng-container matColumnDef="name">
					<th mat-header-cell *matHeaderCellDef> Name </th>
					<td mat-cell [ngClass]="{'track-no-name': !track.name}" *matCellDef="let track; let i = index">
						{{track.name || 'Track ' + (i + 1)}}

					</td>
				</ng-container>

				<ng-container matColumnDef="channel">
					<th mat-header-cell *matHeaderCellDef> Channel </th >
					<td mat-cell *matCellDef="let track"> {{track.channel + 1}} </td >
				</ng-container>

				<ng-container matColumnDef="instrument">
					<th mat-header-cell *matHeaderCellDef> Instrument </th >
					<td mat-cell *matCellDef="let track"> {{track.instrument.name | titlecase}} </td >
				</ng-container>

				<ng-container matColumnDef="family">
					<th mat-header-cell *matHeaderCellDef> Family </th >
					<td mat-cell *matCellDef="let track"> {{track.instrument.family | titlecase}} </td >
				</ng-container>

				<ng-container matColumnDef="kitInstrument">
					<th mat-header-cell *matHeaderCellDef> Kit Instrument Selection </th >
					<td mat-cell *matCellDef="let track; let i = index">
						<select [formControl]="instrumentSelection[i]">
        <option></option>
        <option *ngFor="let kitInstrument of getKitInstruments()" [value]="kitInstrument" >{{kitInstrument}}</option>
      </select> </td >
				</ng-container>
  

  <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
  <ng-container matColumnDef="expandedDetail">
    <td mat-cell *matCellDef="let track; let i = index;" [attr.colspan]="displayColumns.length">
      <app-visualiser class="example-element-detail" [@trackExpanded]="track == expandedTrack ? 'expanded' : 'collapsed'" [midi]="midi" [trackIndex]="i"></app-visualiser>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayColumns"></tr>
  <tr mat-row *matRowDef="let element; columns: displayColumns;"
      class="example-element-row"
      [class.example-expanded-row]="expandedTrack === element"
      (click)="expandedTrack = expandedTrack === element ? null : element">
  </tr>
  <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
</table>
			
	</mat-step>
	<mat-step>
		<ng-template matStepLabel>Export Midi</ng-template>
		<div>
			<button mat-button matStepperPrevious>Previous</button>
		</div>
		<app-export #export [transpose]="transpose" [moveUnsupportedNotes]="moveNotes"
			[moveUnsupportedDrums]="moveDrums" [midi]="midi" [remove0VelocityNotes]="remove0VelocityNotes"
			[kitSelection]="kitSelection" [instrumentSelection]="instrumentSelection">
		</app-export>
	</mat-step>
</mat-horizontal-stepper>